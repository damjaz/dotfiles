#!/bin/bash

#set -x

ans_hist=""
expr_hist="scale=4"
last_ans_len=0

while expr=$(echo -e -n "$ans_hist" | dmenu -l 5 -p 'calculate'); do
  if [[ "$expr" = "copy" ]]; then
    echo -n "$ans" | xsel -b -i
    continue
  fi

  ans=$(echo -e "$expr_hist\n$expr" | bc -l 2>&1)

  if [[ "$last_ans_len" -ne "${#ans}" ]]; then
    last_ans_len="${#ans}"
    ans="$(echo -n -e "$ans" | tail -n 1)"
    ans_hist="$ans\n$ans_hist"
  fi

  expr_hist="$expr_hist\n$expr"
done
