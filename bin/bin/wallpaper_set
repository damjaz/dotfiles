#!/bin/bash

wd="$HOME/images/wallpapers"

while :; do
  # exclude filenames starting with '!'
  wallpapers=($wd/[^!]*)
  # get random filename
  wallpaper="${wallpapers[ RANDOM % ${#wallpapers[@]} ]}"
  # basename
  wallpaper="${wallpaper##*/}"
  # parse arguments
  # filename should be named arguments__name.ext
  # s_w-p_c__sth.jpg is executed as imlibsetroot -s w -p c s_w-p_c__sth.jpg
  args="${wallpaper%%__*}"
  args="-${args//-/ -}"
  args="${args//_/ }"

  imlibsetroot $args "$wd/$wallpaper"
  # change wallpaper every 5 minutes
  sleep 5m
done
